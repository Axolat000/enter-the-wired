#!/bin/bash
set -euo pipefail

# =================================================
# ENTER THE WIRED ‚Äî INSTALLATEUR FINAL
# ACCELA (ciscosweater) + SLSsteam (Axolat000)
# Tout install√© dans le HOME de l‚Äôutilisateur
# =================================================

ACCELA_REPO_URL="https://github.com/ciscosweater/enter-the-wired"
SLS_REPO_URL="https://github.com/Axolat000/enter-the-wired"

ACCELA_DIR="$HOME/enter-the-wired"
SLS_DIR="$HOME/slssteam"
SLS_SUBDIR="SLSsteam-Any"

# -------------------------------------------------
# Couleurs
# -------------------------------------------------
if [ -t 1 ]; then
    GREEN='\033[0;32m'
    RED='\033[0;31m'
    YELLOW='\033[1;33m'
    NC='\033[0m'
else
    GREEN='' RED='' YELLOW='' NC=''
fi

# -------------------------------------------------
# V√©rifier / installer git
# -------------------------------------------------
ensure_git() {
    if command -v git >/dev/null 2>&1; then
        return
    fi

    echo -e "${YELLOW}git non install√©, installation...${NC}"

    if command -v apt >/dev/null 2>&1; then
        sudo apt update && sudo apt install -y git
    elif command -v pacman >/dev/null 2>&1; then
        sudo pacman -Sy --noconfirm git
    elif command -v dnf >/dev/null 2>&1; then
        sudo dnf install -y git
    else
        echo -e "${RED}Impossible d‚Äôinstaller git automatiquement${NC}"
        exit 1
    fi
}

ensure_git

# -------------------------------------------------
# ACCELA
# -------------------------------------------------
if [ ! -d "$ACCELA_DIR/.git" ]; then
    echo -e "${GREEN}Clonage de ACCELA dans $ACCELA_DIR...${NC}"
    git clone "$ACCELA_REPO_URL" "$ACCELA_DIR"
else
    echo -e "${YELLOW}ACCELA d√©j√† pr√©sent, mise √† jour...${NC}"
    git -C "$ACCELA_DIR" pull --ff-only
fi

cd "$ACCELA_DIR"

if [ ! -f "accela" ]; then
    echo -e "${RED}Erreur : script accela introuvable${NC}"
    exit 1
fi

chmod +x accela
source ./accela

echo ""
echo "üì¶ Installation de ACCELA..."
install_accela

# -------------------------------------------------
# SLSsteam
# -------------------------------------------------
if [ ! -d "$SLS_DIR/.git" ]; then
    echo ""
    echo -e "${GREEN}Clonage de SLSsteam dans $SLS_DIR...${NC}"
    git clone "$SLS_REPO_URL" "$SLS_DIR"
else
    echo -e "${YELLOW}SLSsteam d√©j√† pr√©sent, mise √† jour...${NC}"
    git -C "$SLS_DIR" pull --ff-only
fi

cd "$SLS_DIR/$SLS_SUBDIR"

if [ ! -f "setup.sh" ]; then
    echo -e "${RED}Erreur : setup.sh introuvable dans $SLS_SUBDIR${NC}"
    exit 1
fi

chmod +x setup.sh

echo ""
echo "üéÆ Installation de SLSsteam..."
./setup.sh install

# -------------------------------------------------
# Fin
# -------------------------------------------------
echo ""
echo -e "${GREEN}=============================================="
echo " INSTALLATION TERMIN√âE AVEC SUCC√àS"
echo "==============================================${NC}"
echo ""
echo "üìç Emplacements :"
echo " ‚Ä¢ ACCELA   : $ACCELA_DIR"
echo " ‚Ä¢ SLSsteam : $SLS_DIR"
echo ""
echo "üîÑ Red√©marre Steam pour activer SLSsteam"
echo ""
echo "Bienvenue dans le Wired."
